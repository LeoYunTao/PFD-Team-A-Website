@model DashboardViewModel

@{
    ViewData["Title"] = "Index";
}

<!DOCTYPE html>

<html>
<head>
    <!-- Use Unicode character encoding - multi-language compatibity -->
    <meta charset="utf-8">
    <!-- Set the initial view zooming scale for mobile device -->
    <meta name="viewport" content="width = device-width,
 initial-scale = 1" />
    <title>Dashboard</title>
    <!-- Reference to customized styling for this website -->
    <link rel="stylesheet" type="text/css" href="~/css/Site.css">
</head>
<body>
    <h1 class="mt-4 mb-4">Test Cases</h1>
    <form asp-controller="Dashboard" asp-action="RunTest" method="post" class="container">
        <div class="row">
            <section class="col-lg-5 shadow rounded px-4 py-3">
                <label asp-for="OperatingSystems" class="form-label fw-bold mb-2"></label>
                @for(int i = 0; i < Model.OperatingSystems.Count; i++)
                {
                    <div class="form-check">
                        <input class="form-check-input" asp-for="@Model.OperatingSystems[i].IsSelected">
                        <label class="form-check-label" asp-for="@Model.OperatingSystems[i].IsSelected">
                            @Model.OperatingSystems[i].DisplayName
                        </label>
                        <input type="hidden" asp-for="@Model.OperatingSystems[i].DisplayName">
                        <input type="hidden" asp-for="@Model.OperatingSystems[i].Value">
                    </div>
                }
            </section>
            <section class="col-lg-5 shadow rounded offset-lg-1 px-4 py-3">
                <label asp-for="TestCases" class="form-label fw-bold mb-2"></label>
                @for (int i = 0; i < Model.TestCases.Count; i++)
                {
                    <div class="form-check">
                        <input class="form-check-input" asp-for="@Model.TestCases[i].IsSelected">
                        <label class="form-check-label" asp-for="@Model.TestCases[i].IsSelected">
                            @Model.TestCases[i].Value
                        </label>
                        <input type="hidden" asp-for="@Model.TestCases[i].Value">
                    </div>
                }
            </section>
        </div>
        <div class="row mt-lg-4">
            <section class="col-lg-5 shadow rounded px-4 py-3">
                <div id="emails">
                    <label asp-for="Emails" class="form-label fw-bold mb-2"></label>
                    @for (int i = 0; i < Model.Emails.Count; i++)
                    {
                        <div class="form-check ps-0">
                            <input class="form-check-input" hidden asp-for="@Model.Emails[i].IsSelected">
                            <label class="form-check-label" asp-for="@Model.Emails[i].IsSelected">
                                @Model.Emails[i].Value
                            </label>
                            <input type="hidden" asp-for="@Model.Emails[i].Value">
                        </div>
                    }
                </div>
                
                <button type="button" class="btn btn-dark mt-2 mb-3" id="addEmailButton" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                    Add New Email
                </button>

                <div class="form-group collapse border rounded p-3" id="collapseExample">
                    <label for="exampleInputEmail1" class="mb-2">Email address</label>
                    <input type="email" class="form-control" id="exampleInputEmail1" name="email" aria-describedby="emailHelp" placeholder="Enter email">
                    <!--<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>-->
                </div>
            </section>
            <section class="col-lg-5 shadow rounded offset-lg-1 px-4 py-3">
                <label asp-for="Browsers" class="form-label text-center fw-bold mb-2"></label>
                @for (int i = 0; i < Model.Browsers.Count; i++)
                {
                    <div class="form-check">
                        <input class="form-check-input" asp-for="@Model.Browsers[i].IsSelected">
                        <label class="form-check-label" asp-for="@Model.Browsers[i].IsSelected">
                            @Model.Browsers[i].DisplayName
                        </label>
                        <input type="hidden" asp-for="@Model.Browsers[i].DisplayName">
                        <input type="hidden" asp-for="@Model.Browsers[i].Value">
                    </div>
                }
            </section>
        </div>
        
        <div class="mt-lg-5 text-center">
            <input class="btn btn-dark" type="submit" value="Run Test">
        </div>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
        const isEmailValid = (email) => {
            return String(email)
                .toLowerCase()
                .match(
                    /^(([^<>()[\]\\.,;:\s@@"]+(\.[^<>()[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                );
        };

        $("#addEmailButton").click(() => {
            let emailElement = $("#exampleInputEmail1");

            let email = emailElement.val();

            if (email == "") return;

            if (!isEmailValid(email))
            {
                emailElement.val("");
                alert("Email is not valid");
                return;
            }

            $.ajax({
                type: "POST",
                url: '@Url.Action("AddEmail")',
                data: emailElement.serialize(),
                success: html => {
                    window.location.href = "@Url.Action("Dashboard")";
                }
            });

        });
    </script>
</body>
</html>